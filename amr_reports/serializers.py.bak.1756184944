from rest_framework import serializers
from .models import LabResult, Facility

class FacilityField(serializers.SlugRelatedField):
    def to_internal_value(self, data):
        if data in (None, "",):
            return None
        obj, _ = Facility.objects.get_or_create(name=str(data).strip())
        return obj

class LabResultSerializer(serializers.ModelSerializer):
    facility = FacilityField(slug_field='name', required=False, allow_null=True)

    class Meta:
        model = LabResult
        fields = '__all__'
